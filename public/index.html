<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Шахматы для админов</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; background-color: #f0f0f0; margin: 0; }
        .game-container { display: flex; flex-direction: column; align-items: center; background-color: white; padding: 20px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .board { display: grid; grid-template-columns: repeat(8, 50px); grid-template-rows: repeat(8, 50px); border: 2px solid #333; }
        .square { width: 50px; height: 50px; display: flex; justify-content: center; align-items: center; font-size: 30px; cursor: pointer; user-select: none; }
        .light { background-color: #f0d9b5; }
        .dark { background-color: #b58863; }
        .selected { background-color: #58a4b0; }
        .highlight { background-color: #f7ca12; }
        .message-box { margin-top: 20px; font-weight: bold; text-align: center; }
        h1, h2 { margin: 10px 0; }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>Шахматы для админов</h1>
        <h2 id="turn-status">Ожидание хода...</h2>
        <div class="board" id="chess-board"></div>
    </div>
    
    <script>
        const boardElement = document.getElementById('chess-board');
        const turnStatusElement = document.getElementById('turn-status');
        const ws = new WebSocket('ws://localhost:10000');
        
        let selectedSquare = null;
        let boardState = null;
        let currentTurn = 'w';
        
        // Символы фигур Unicode
        const pieceSymbols = {
            'r': '♜', 'n': '♞', 'b': '♝', 'q': '♛', 'k': '♚', 'p': '♟',
            'R': '♖', 'N': '♘', 'B': '♗', 'Q': '♕', 'K': '♔', 'P': '♙',
            '.': ''
        };

        ws.onopen = () => {
            console.log('Подключен к серверу');
            // При подключении, сообщаем серверу, что это админ, который хочет играть в шахматы
            ws.send(JSON.stringify({ type: 'admin_connect', role: 'admin' }));
        };

        ws.onmessage = (event) => {
            const data = JSON.parse(event.data);
            console.log('Получено сообщение:', data);

            if (data.type === 'chess_state_update') {
                boardState = data.board;
                currentTurn = data.turn;
                turnStatusElement.textContent = `Сейчас ходят ${currentTurn === 'w' ? 'Белые' : 'Черные'}`;
                drawBoard();
            }
        };

        ws.onclose = () => {
            console.log('Отключен от сервера');
            turnStatusElement.textContent = 'Отключен от сервера. Перезагрузите страницу.';
        };
        
        function drawBoard() {
            boardElement.innerHTML = '';
            for (let row = 0; row < 8; row++) {
                for (let col = 0; col < 8; col++) {
                    const square = document.createElement('div');
                    square.classList.add('square');
                    square.classList.add((row + col) % 2 === 0 ? 'light' : 'dark');
                    square.dataset.row = row;
                    square.dataset.col = col;

                    const piece = boardState[row][col];
                    square.textContent = pieceSymbols[piece] || '';

                    square.addEventListener('click', () => handleSquareClick(row, col));
                    boardElement.appendChild(square);
                }
            }
        }

        function handleSquareClick(row, col) {
            if (!boardState) return;
            const clickedPiece = boardState[row][col];

            // Если ничего не выбрано, выбираем фигуру
            if (selectedSquare === null && clickedPiece !== '.') {
                selectedSquare = { row, col };
                const squareElement = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
                squareElement.classList.add('selected');
            } else if (selectedSquare) {
                // Если фигура уже выбрана, пытаемся сделать ход
                const move = {
                    from: { row: selectedSquare.row, col: selectedSquare.col },
                    to: { row, col }
                };
                ws.send(JSON.stringify({ type: 'chess_move', move }));
                
                // Сбрасываем выбор
                const selectedElement = document.querySelector('.selected');
                if (selectedElement) {
                    selectedElement.classList.remove('selected');
                }
                selectedSquare = null;
            }
        }
    </script>
</body>
</html>
